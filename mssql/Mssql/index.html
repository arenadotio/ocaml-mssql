<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Mssql (mssql.Mssql)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">mssql</a> &#x00BB; Mssql</nav><h1>Module <code>Mssql</code></h1></header><div class="spec module" id="module-Error"><a href="#module-Error" class="anchor"></a><code><span class="keyword">module</span> Error = <a href="../Mssql__/index.html#module-Mssql_error">Mssql__.Mssql_error</a></code></div><div class="spec module" id="module-Param"><a href="#module-Param" class="anchor"></a><code><span class="keyword">module</span> Param = <a href="../Mssql__/index.html#module-Db_field">Mssql__.Db_field</a></code></div><div class="spec module" id="module-Row"><a href="#module-Row" class="anchor"></a><code><span class="keyword">module</span> <a href="Row/index.html">Row</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div><div class="spec include"><div class="doc"><details open="open"><summary><span class="def"><code><span class="keyword">include</span> <a href="../Mssql__/index.html#module-Client">Mssql__.Client</a></code></span></summary><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt></dl><dl><dt class="spec value" id="val-with_conn"><a href="#val-with_conn" class="anchor"></a><code><span class="keyword">val</span> with_conn : <span>host:string</span> <span>&#45;&gt;</span> <span>db:string</span> <span>&#45;&gt;</span> <span>user:string</span> <span>&#45;&gt;</span> <span>password:string</span> <span>&#45;&gt;</span> <span>?&#8288;port:int</span> <span>&#45;&gt;</span> <span>(<a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Async_kernel.Deferred.t</span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Async_kernel.Deferred.t</span></code></dt><dd><p>Opens a connection, runs the callback, then closes the connection. Don't try to use the DB handle outside of the callback, since it will have been closed automatically.</p></dd></dl><dl><dt class="spec value" id="val-execute"><a href="#val-execute" class="anchor"></a><code><span class="keyword">val</span> execute : <span>?&#8288;params:<span><span><a href="../Mssql__/Db_field/index.html#type-t">Mssql__.Db_field.t</a> option</span> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><span><a href="Row/index.html#type-t">Row.t</a> list</span> Async_kernel.Deferred.t</span></code></dt><dd><p>Executes an SQL query, handling parameter quoting for you. Do not use <code>sprintf</code> to generate queries; instead pass parameters like this:</p><pre><code class="ml">let params = [ Some (Mssql.Param.String &quot;look no ' sql injection\x00!&quot;) ] in
Mssql.execute ~params &quot;SELECT $1&quot;</code></pre><p>Returns a single result set and throws an exception if the result has more than one result set.</p></dd></dl><dl><dt class="spec value" id="val-execute_map"><a href="#val-execute_map" class="anchor"></a><code><span class="keyword">val</span> execute_map : <span>?&#8288;params:<span><span><a href="../Mssql__/Db_field/index.html#type-t">Mssql__.Db_field.t</a> option</span> list</span></span> <span>&#45;&gt;</span> <span>f:<span>(<a href="Row/index.html#type-t">Row.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span>)</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><span><span class="type-var">'a</span> list</span> Async_kernel.Deferred.t</span></code></dt><dt class="spec value" id="val-execute_iter"><a href="#val-execute_iter" class="anchor"></a><code><span class="keyword">val</span> execute_iter : <span>?&#8288;params:<span><span><a href="../Mssql__/Db_field/index.html#type-t">Mssql__.Db_field.t</a> option</span> list</span></span> <span>&#45;&gt;</span> <span>f:<span>(<a href="Row/index.html#type-t">Row.t</a> <span>&#45;&gt;</span> unit)</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span>unit Async_kernel.Deferred.t</span></code></dt><dt class="spec value" id="val-execute_fold"><a href="#val-execute_fold" class="anchor"></a><code><span class="keyword">val</span> execute_fold : <span>?&#8288;params:<span><span><a href="../Mssql__/Db_field/index.html#type-t">Mssql__.Db_field.t</a> option</span> list</span></span> <span>&#45;&gt;</span> <span>init:<span class="type-var">'a</span></span> <span>&#45;&gt;</span> <span>f:<span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <a href="Row/index.html#type-t">Row.t</a> <span>&#45;&gt;</span> <span class="type-var">'a</span>)</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Async_kernel.Deferred.t</span></code></dt><dt class="spec value" id="val-execute_pipe"><a href="#val-execute_pipe" class="anchor"></a><code><span class="keyword">val</span> execute_pipe : <span>?&#8288;params:<span><span><a href="../Mssql__/Db_field/index.html#type-t">Mssql__.Db_field.t</a> option</span> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><a href="Row/index.html#type-t">Row.t</a> Async_kernel.Pipe.Reader.t</span></code></dt><dt class="spec value" id="val-execute_unit"><a href="#val-execute_unit" class="anchor"></a><code><span class="keyword">val</span> execute_unit : <span>?&#8288;params:<span><span><a href="../Mssql__/Db_field/index.html#type-t">Mssql__.Db_field.t</a> option</span> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span>unit Async_kernel.Deferred.t</span></code></dt><dd><p>Like <code>execute</code> but asserts that the result set will be empty.</p></dd></dl><dl><dt class="spec value" id="val-execute_single"><a href="#val-execute_single" class="anchor"></a><code><span class="keyword">val</span> execute_single : <span>?&#8288;params:<span><span><a href="../Mssql__/Db_field/index.html#type-t">Mssql__.Db_field.t</a> option</span> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><span><a href="Row/index.html#type-t">Row.t</a> option</span> Async_kernel.Deferred.t</span></code></dt><dd><p>Like <code>execute</code> but asserts that the result set will return a maximum of 1 row.</p></dd></dl><dl><dt class="spec value" id="val-execute_multi_result"><a href="#val-execute_multi_result" class="anchor"></a><code><span class="keyword">val</span> execute_multi_result : <span>?&#8288;params:<span><span><a href="../Mssql__/Db_field/index.html#type-t">Mssql__.Db_field.t</a> option</span> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><span><span><a href="Row/index.html#type-t">Row.t</a> list</span> list</span> Async_kernel.Deferred.t</span></code></dt><dd><p>Like <code>execute</code> but returns all result sets. Useful for running multiple queries at once.</p></dd></dl><dl><dt class="spec value" id="val-execute_many"><a href="#val-execute_many" class="anchor"></a><code><span class="keyword">val</span> execute_many : <span>params:<span><span><span><a href="../Mssql__/Db_field/index.html#type-t">Mssql__.Db_field.t</a> option</span> list</span> list</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <span><span><span><a href="Row/index.html#type-t">Row.t</a> list</span> list</span> Async_kernel.Deferred.t</span></code></dt><dd><p>List <code>execute</code> except runs multiple identical queries at the same time, with different parameters. Takes a list of param lists and returns a list of results sets, as if you called <code>List.map params ~f:(fun params -&gt; execute ~params db query)</code></p></dd></dl><dl><dt class="spec value" id="val-begin_transaction"><a href="#val-begin_transaction" class="anchor"></a><code><span class="keyword">val</span> begin_transaction : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit Async_kernel.Deferred.t</span></code></dt><dd><p>Begin a transaction</p></dd></dl><dl><dt class="spec value" id="val-commit"><a href="#val-commit" class="anchor"></a><code><span class="keyword">val</span> commit : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit Async_kernel.Deferred.t</span></code></dt><dd><p>Commit the current transaction</p></dd></dl><dl><dt class="spec value" id="val-rollback"><a href="#val-rollback" class="anchor"></a><code><span class="keyword">val</span> rollback : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit Async_kernel.Deferred.t</span></code></dt><dd><p>Rollback the current transaction</p></dd></dl><dl><dt class="spec value" id="val-with_transaction"><a href="#val-with_transaction" class="anchor"></a><code><span class="keyword">val</span> with_transaction : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>(<a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Async_kernel.Deferred.t</span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Async_kernel.Deferred.t</span></code></dt><dd><p><code>with_transaction t f</code> runs <code>f</code> in a transaction. If the function returns normally, the transaction will be commited. If the function throws an exception, the transaction will be rolled back and the exception will be re-raised.</p><p>Note regarding the <code>t</code> argument to the callback: There is logic to ensure that queries outside of the transaction are blocked until the transaction finishes, so you *must* use the <code>t</code> passed in the callback, not the original handle inside of the transaction. To prevent deadlocks, an exception will be thrown if you use the external DB handle inside of with_transaction.</p></dd></dl><dl><dt class="spec value" id="val-with_transaction_or_error"><a href="#val-with_transaction_or_error" class="anchor"></a><code><span class="keyword">val</span> with_transaction_or_error : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>(<a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Async_kernel.Deferred.Or_error.t</span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Async_kernel.Deferred.Or_error.t</span></code></dt><dd><p>Like <code>with_transaction</code> but also rolls back the transaction on <code>Error</code></p></dd></dl></details></div></div></div><dl><dt class="spec exception" id="exception-Error"><a href="#exception-Error" class="anchor"></a><code><span class="keyword">exception</span> </code><code><span class="exception">Error</span> <span class="keyword">of</span> <a href="../Mssql__/Mssql_error/index.html#type-t">Error.t</a></code></dt></dl></div></body></html>